# ğŸš€ é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### éœ€è¦çš„ä¿¡æ¯
- [ ] æœåŠ¡å™¨å…¬ç½‘ IP åœ°å€
- [ ] SSH ç™»å½•ç”¨æˆ·åï¼ˆé€šå¸¸æ˜¯ `root` æˆ– `ubuntu`ï¼‰
- [ ] SSH å¯†ç æˆ–å¯†é’¥
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å€¼ï¼ˆä» Vercel è·å–ï¼‰

---

## æ­¥éª¤ 1: è¿æ¥æœåŠ¡å™¨

### è·å–æœåŠ¡å™¨ä¿¡æ¯
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ ECS å®ä¾‹åˆ—è¡¨
3. æ‰¾åˆ°æ‚¨è´­ä¹°çš„æœåŠ¡å™¨
4. è®°å½• **å…¬ç½‘ IP åœ°å€**

### è¿æ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨ root ç”¨æˆ·è¿æ¥ï¼ˆå¦‚æœä½¿ç”¨å¯†ç ï¼‰
ssh root@your-server-ip

# æˆ–ä½¿ç”¨ ubuntu ç”¨æˆ·ï¼ˆå¦‚æœé•œåƒæ˜¯ Ubuntuï¼‰
ssh ubuntu@your-server-ip

# å¦‚æœä½¿ç”¨å¯†é’¥æ–‡ä»¶
ssh -i /path/to/your-key.pem root@your-server-ip
```

**æç¤º**: é¦–æ¬¡è¿æ¥ä¼šæç¤ºç¡®è®¤ï¼Œè¾“å…¥ `yes` ç»§ç»­ã€‚

---

## æ­¥éª¤ 2: åˆå§‹åŒ–æœåŠ¡å™¨ç¯å¢ƒ

### åˆ›å»ºåº”ç”¨ç›®å½•
```bash
# åˆ›å»ºç›®å½•
sudo mkdir -p /var/www/tiktok-ai-mcn
sudo chown -R $USER:$USER /var/www/tiktok-ai-mcn
cd /var/www/tiktok-ai-mcn
```

### å…‹éš†ä»£ç 
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/xuzone8888/tiktok-ai-mcn.git .

# æˆ–å¦‚æœç›®å½•å·²å­˜åœ¨
cd /var/www
git clone https://github.com/xuzone8888/tiktok-ai-mcn.git
cd tiktok-ai-mcn
```

### è¿è¡Œåˆå§‹åŒ–è„šæœ¬
```bash
# è¿è¡ŒæœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬
bash deploy/setup-server.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼š
- âœ… Node.js 20.x
- âœ… PM2 è¿›ç¨‹ç®¡ç†å™¨
- âœ… Nginx åå‘ä»£ç†
- âœ… Certbot (SSL è¯ä¹¦å·¥å…·)
- âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
- âœ… åˆ›å»ºæ—¥å¿—ç›®å½•

**é¢„è®¡æ—¶é—´**: 5-10 åˆ†é’Ÿ

---

## æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

### åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
# åˆ›å»º .env.local æ–‡ä»¶
nano .env.local
```

### å¤åˆ¶ä»¥ä¸‹æ¨¡æ¿å¹¶å¡«å…¥å®é™…å€¼

```bash
# ==========================================
# Supabase é…ç½®ï¼ˆä» Vercel ç¯å¢ƒå˜é‡è·å–ï¼‰
# ==========================================
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ==========================================
# API å¯†é’¥ï¼ˆä» Vercel ç¯å¢ƒå˜é‡è·å–ï¼‰
# ==========================================
DOUBAO_API_KEY=your_doubao_key
DOUBAO_ENDPOINT_ID=your_endpoint_id
SORA2_API_KEY=your_sora2_key
SUCHUANG_API_KEY=your_suchuang_key

# ==========================================
# åº”ç”¨é…ç½®
# ==========================================
# ä½¿ç”¨æœåŠ¡å™¨ IP æˆ–åŸŸå
NEXT_PUBLIC_APP_URL=http://your-server-ip:3000
# æˆ–ä½¿ç”¨åŸŸå: NEXT_PUBLIC_APP_URL=https://cn.tokfactoryai.com

# ==========================================
# ç®¡ç†å‘˜é…ç½®
# ==========================================
ADMIN_EMAIL=admin@example.com
```

### å¦‚ä½•è·å–ç¯å¢ƒå˜é‡å€¼

**ä» Vercel è·å–**:
1. ç™»å½• Vercel
2. è¿›å…¥é¡¹ç›®è®¾ç½®: `Settings` > `Environment Variables`
3. ç‚¹å‡»æ¯ä¸ªå˜é‡æ—è¾¹çš„ "Click to reveal" æŸ¥çœ‹å€¼
4. å¤åˆ¶åˆ° `.env.local` æ–‡ä»¶

**é‡è¦**: 
- `NEXT_PUBLIC_APP_URL` åº”è¯¥ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨çš„ IP æˆ–åŸŸå
- å…¶ä»–å˜é‡å€¼ä¸ Vercel å®Œå…¨ç›¸åŒ

### ä¿å­˜æ–‡ä»¶
åœ¨ nano ç¼–è¾‘å™¨ä¸­ï¼š
1. æŒ‰ `Ctrl+X` é€€å‡º
2. æŒ‰ `Y` ç¡®è®¤ä¿å­˜
3. æŒ‰ `Enter` ç¡®è®¤æ–‡ä»¶å

### éªŒè¯ç¯å¢ƒå˜é‡
```bash
# è¿è¡Œæ£€æŸ¥è„šæœ¬
bash deploy/check-env.sh
```

ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡éƒ½å·²é…ç½®ã€‚

---

## æ­¥éª¤ 4: éƒ¨ç½²åº”ç”¨

### è¿è¡Œéƒ¨ç½²è„šæœ¬
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /var/www/tiktok-ai-mcn

# è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy/deploy.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. âœ… æ£€æŸ¥ Node.js å’Œ PM2
2. âœ… æ‹‰å–æœ€æ–°ä»£ç 
3. âœ… å®‰è£…ä¾èµ–åŒ…
4. âœ… æ„å»º Next.js åº”ç”¨
5. âœ… å¯åŠ¨ PM2 è¿›ç¨‹

**é¢„è®¡æ—¶é—´**: 3-5 åˆ†é’Ÿ

### æ£€æŸ¥åº”ç”¨çŠ¶æ€
```bash
# æŸ¥çœ‹ PM2 çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs tiktok-ai-mcn --lines 50
```

åº”è¯¥çœ‹åˆ°åº”ç”¨æ­£åœ¨è¿è¡Œã€‚

---

## æ­¥éª¤ 5: é…ç½®å®‰å…¨ç»„ï¼ˆé‡è¦ï¼‰

### åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®
1. è¿›å…¥ ECS æ§åˆ¶å°
2. ç‚¹å‡»æ‚¨çš„å®ä¾‹
3. è¿›å…¥ **å®‰å…¨ç»„** æ ‡ç­¾
4. ç‚¹å‡»å®‰å…¨ç»„ ID
5. ç‚¹å‡» **å…¥æ–¹å‘è§„åˆ™** > **æ·»åŠ å®‰å…¨ç»„è§„åˆ™**

æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

| è§„åˆ™æ–¹å‘ | æˆæƒç­–ç•¥ | åè®®ç±»å‹ | ç«¯å£èŒƒå›´ | æˆæƒå¯¹è±¡ |
|---------|---------|---------|---------|---------|
| å…¥æ–¹å‘ | å…è®¸ | TCP | 22/22 | 0.0.0.0/0 (SSH) |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 80/80 | 0.0.0.0/0 (HTTP) |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 443/443 | 0.0.0.0/0 (HTTPS) |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 3000/3000 | 0.0.0.0/0 (åº”ç”¨ç«¯å£ï¼Œå¯é€‰) |

---

## æ­¥éª¤ 6: æµ‹è¯•è®¿é—®

### ç›´æ¥è®¿é—®åº”ç”¨
```bash
# åœ¨æµè§ˆå™¨ä¸­è®¿é—®
http://your-server-ip:3000
```

å¦‚æœèƒ½çœ‹åˆ°ç½‘ç«™ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼

---

## æ­¥éª¤ 7: é…ç½® Nginxï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

### é…ç½® Nginx åå‘ä»£ç†
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
sudo cp deploy/nginx.conf.template /etc/nginx/sites-available/tiktok-ai-mcn

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/tiktok-ai-mcn
```

### ä¿®æ”¹é…ç½®
å°† `your-domain.com` æ›¿æ¢ä¸ºï¼š
- æ‚¨çš„åŸŸåï¼ˆå¦‚æœæœ‰ï¼‰
- æˆ–æœåŠ¡å™¨ IPï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰

### å¯ç”¨é…ç½®
```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/tiktok-ai-mcn /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

### è®¿é—®æµ‹è¯•
```bash
# é€šè¿‡ Nginx è®¿é—®ï¼ˆå¦‚æœé…ç½®äº†åŸŸåï¼‰
http://your-domain.com

# æˆ–é€šè¿‡ IP è®¿é—®
http://your-server-ip
```

---

## æ­¥éª¤ 8: é…ç½® SSL è¯ä¹¦ï¼ˆæ¨èï¼Œç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼‰

### ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
```bash
# ç”³è¯· SSL è¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾
# 3. é€‰æ‹©æ˜¯å¦åˆ†äº«é‚®ç®±ï¼ˆå¯é€‰ï¼‰
```

è¯ä¹¦ä¼šè‡ªåŠ¨é…ç½®å¹¶è®¾ç½®è‡ªåŠ¨ç»­æœŸã€‚

### è®¿é—® HTTPS
```bash
# ç°åœ¨å¯ä»¥é€šè¿‡ HTTPS è®¿é—®
https://your-domain.com
```

---

## âœ… éƒ¨ç½²éªŒè¯

### æ£€æŸ¥æ¸…å•
- [ ] åº”ç”¨å¯ä»¥é€šè¿‡ IP:3000 è®¿é—®
- [ ] PM2 æ˜¾ç¤ºåº”ç”¨æ­£åœ¨è¿è¡Œ
- [ ] æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯
- [ ] å¯ä»¥æ­£å¸¸ç™»å½•ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
- [ ] API æ¥å£å¯ä»¥æ­£å¸¸è°ƒç”¨

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs tiktok-ai-mcn

# é‡å¯åº”ç”¨
pm2 restart tiktok-ai-mcn

# åœæ­¢åº”ç”¨
pm2 stop tiktok-ai-mcn

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
pm2 monit
```

---

## ğŸ”„ åç»­æ›´æ–°

å½“ä»£ç æ›´æ–°åï¼Œåªéœ€è¿è¡Œï¼š
```bash
cd /var/www/tiktok-ai-mcn
bash deploy/deploy.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æ— æ³•è¿æ¥æœåŠ¡å™¨
```bash
# æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 22 ç«¯å£
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
# æ£€æŸ¥ IP åœ°å€æ˜¯å¦æ­£ç¡®
```

### é—®é¢˜ 2: åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs tiktok-ai-mcn --lines 100

# æ£€æŸ¥ç¯å¢ƒå˜é‡
bash deploy/check-env.sh

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 3000
```

### é—®é¢˜ 3: æ— æ³•è®¿é—®ç½‘ç«™
```bash
# æ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
```

### é—®é¢˜ 4: æ„å»ºå¤±è´¥
```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version  # åº”è¯¥æ˜¯ v20.x.x

# æ¸…ç†å¹¶é‡æ–°å®‰è£…
rm -rf node_modules .next
npm install
npm run build
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿—: `pm2 logs tiktok-ai-mcn`
2. ç³»ç»Ÿä¿¡æ¯: `uname -a`
3. Node.js ç‰ˆæœ¬: `node --version`
4. å…·ä½“é”™è¯¯ä¿¡æ¯

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰






